<source>
  @type  forward
  port  24224
</source>
<filter docker.**>
  @type record_transformer
  enable_ruby
  <record>
    # filtering ANSI color characters from log message
    message ${log.gsub(/\033\[\d{1,2}(;\d{1,2}){0,2}[mGK]/, '')}
    severity ${source == 'stderr' ? 'error' : 'info'}
  </record>
  remove_keys source,log,container_id,container_name
</filter>
<match **>
  @type copy
  <store>
    @type file
    path /fluentd/log/docker.*.log
    symlink_path /fluentd/log/docker.log
    append true
    time_slice_format %Y%m%d
    time_slice_wait 10m
    compress gzip
    utc
  </store>
  <store>
    @type google_cloud
    flush_interval 5
    zone "#{ENV['VM_ZONE']}"
    vm_id "#{ENV['VM_ID']}"
  </store>
</match>